function nc_peh_patient(e){function s(e){for(var t,n,r=e.length;r;t=Math.floor(Math.random()*r),n=e[--r],e[r]=e[t],e[t]=n);return e}function o(){var t=[],n,r;n=Array.apply(null,{length:e.numberOfWoundType}).map(Number.call,Number);while(t.length<e.numberOfWound){n=s(n);r=n.pop();t.push(r);n=$.grep(n,function(e){return e!=r});if(e.conflicts.length){$.each(e.conflicts,function(e,t){if($.inArray(r,t)!==-1){$.each(t,function(e,t){n=$.grep(n,function(e){return e!=t})})}})}if(t.length<e.numberOfWound&&n.length==0){throw new RangeError("wound type is less than number of wound to be generated.")}}return t}function u(e,t,n,i){r.push({wt:e,tt:t,p:n,s:i,t:(new Date).getTime()})}var t,n,r,i={numberOfWoundType:9,numberOfWound:3,conflicts:[[2,6],[3,4,5],[0,1],[7,8]],treatmentsDone:function(){alert("done")}};e=$.extend(true,{},i,e);this.getWound=function(){return t};this.getTreatmentData=function(){return r};this.getTreatment=function(){return n};this.resetPatient=function(){t=o();n=Array.apply(null,t).map(Number.prototype.valueOf,-1);r=[]};this.curePatientAuto=function(r){var i=$.inArray(r,t);if(i!==-1){if(n[i]==-1){u(-1,r,i,true);n[i]=r;if($.inArray(-1,n)==-1){if(e.treatmentsDone)e.treatmentsDone()}return 1}else{u(-1,r,-1,false);return 2}}else{u(-1,r,-1,false);return 0}};this.curePatient=function(r,i){if(n[i]==-1){u(t[i],r,i,t[i]==r);if(t[i]==r){n[i]=r;if($.inArray(-1,n)==-1){e.treatmentsDone()}return 1}else{return 0}}else{return 2}};this.isWound=function(e){var r=$.inArray(e,t);return r!==-1&&n[r]==-1}}function nc_clockTimer(){function f(){if(a){u=false;a=false;return}if(u)return;u=true;n=(new Date).getTime();var t=(n-e)/1e3>>0;if(t==r){if(o)o()}else{if(t!=i){i=t;if(s)s(i)}setTimeout(function(){u=false;f()},200)}}var e,t,n,r,i,s,o,u,a;u=false;a=false;this.start=function(t,n,l){a=false;u=false;e=(new Date).getTime();r=t;i=0;s=l;o=n;f()};this.stop=function(){a=true}}function nc_peh_char(e){function o(){t.css({bottom:n.y+20,left:n.x})}function u(){if(i)return;a()}function a(){if(!r.length){i=false;if(e.onAnimationComplete)e.onAnimationComplete();return}i=true;var t=r.shift();var s,o,u;o=Math.abs(n.x-t.x);if(t.slow){u=o/150}else{u=o/300}f(t.x,u);setTimeout(a,u*1e3)}function f(t,r){TweenMax.to(n,r,{x:t,onupdateparams:n,onUpdate:function(){var t;t=Math.abs(20*Math.sin(Math.PI*((n.x+e.offsetX)%50/50)));n.y=t;o()},ease:Linear.easeNone})}function l(e,n){t.find("."+e).removeClass().addClass(e+" "+n)}function c(t,n){r.push(t);e.onAnimationComplete=n;u()}var t,n,r,i,s={offsetY:20,offsetX:10,startPos:-210,endPos:390,charSelector:"#gamechar",onAnimationComplete:null};e=$.extend(true,{},s,e);t=$(e.charSelector);r=[];i=false;this.setCharIndex=function(e){t.removeClass().addClass("char char"+e)};this.enterClinic=function(e){c({x:190,slow:true},e)};this.leaveClinic=function(e){c({x:590},e)};this.setPatientStat=function(e,t){console.log(e);if($.inArray(-1,t)===-1){l("cface","happy")}else{l("cface","")}$.each(e,function(e,n){if($.inArray(n,t)!==-1){switch(n){case 0:l("chead","headcured");break;case 1:l("chead","facecured");break;case 2:l("cshoulder","cured");break;case 3:l("clefthand","elbowcured");break;case 4:l("clefthand","fingercured");break;case 5:l("clefthand","wristcured");break;case 6:l("crighthand","armcured");break;case 7:l("cleftfoot","cured");break;case 8:l("crightfoot","cured");break}}else{switch(n){case 0:l("chead","headinjured");break;case 1:l("chead","faceinjured");break;case 2:l("cshoulder","injured");break;case 3:l("clefthand","elbowinjured");break;case 4:l("clefthand","fingerinjured");break;case 5:l("clefthand","wristinjured");break;case 6:l("crighthand","arminjured");break;case 7:l("cleftfoot","injured");break;case 8:l("crightfoot","injured");break}}})};this.setClass=function(e){t.removeClass().addClass(e)};this.reset=function(){n={x:e.startPos,y:e.offsetY};o();l("chead","");l("cface","");l("clefthand","");l("crighthand","");l("cshoulder","");l("cleftfoot","");l("crightfoot","")}}function nc_peh_clinic(e){function o(e){$(".room").droppable({disabled:e})}function u(){t.resetPatient();n.reset();n.setCharIndex(parseInt(Math.random()*6+1,10));n.setPatientStat(t.getWound(),t.getTreatment());o(true);n.enterClinic(function(){o(false)})}function a(e){switch(true){case e.indexOf("bandage1")!==-1:return 0;break;case e.indexOf("bandage2")!==-1:return 1;break;case e.indexOf("bandage3")!==-1:return 2;break;case e.indexOf("bandage4")!==-1:return 3;break;case e.indexOf("bandage5")!==-1:return 4;break;case e.indexOf("bandage6")!==-1:return 5;break;case e.indexOf("bandage7")!==-1:return 6;break;case e.indexOf("bandage8")!==-1:return 7;break;case e.indexOf("bandage9")!==-1:return 8;break}}function f(e){return{x:e.offset().left-$(".room").offset().left,y:e.offset().top-$(".room").offset().top,width:e.width(),height:e.height()}}function l(e,t){var n;switch(t){case 0:case 1:n=f($(".chead"));break;case 2:n=f($(".cshoulder"));break;case 3:case 4:case 5:n=f($(".clefthand"));break;case 6:n=f($(".crighthand"));break;case 7:n=f($(".cleftfoot"));break;case 8:n=f($(".crightfoot"));break}console.log(n);console.log(e);return!(e.x>n.x+n.width||e.x+e.width<n.x||e.y>n.y+n.height||e.y+e.height<n.y)}function c(){console.log("wrong")}function h(){console.log("correct")}function p(e,r){var i=a(r.draggable.attr("class"));if(t.isWound(i)){var s={y:r.helper.offset().top-$(".room").offset().top,x:r.helper.offset().left-$(".room").offset().left,width:r.helper.width(),height:r.helper.height()};if(l(s,i)){t.curePatientAuto(i);console.log(t.getTreatment());n.setPatientStat(t.getWound(),t.getTreatment());h();if($.inArray(-1,t.getTreatment())===-1){o(true);setTimeout(function(){n.leaveClinic(u)},500)}}else{}}else{c(s)}}var t,n,r,i,s={numberOfWoundType:9,numberOfWound:3,conflicts:[],duration:60,onTimerUpdate:null,onTimerDone:null,onGameEnd:null,onGameStart:null,treatmentsDone:null};e=$.extend(true,{},s,e);t=new nc_peh_patient(e);n=new nc_peh_char;r=new nc_clockTimer;this.init=function(){$(".bandage").draggable({helper:function(){return $(this).clone().css({background:"none",color:"#000","text-align":"center"})},cursorAt:{top:42,left:42}});$(".room").droppable({accept:".bandage",activeClass:"ready",hoverClass:"ondragover",drop:p})};this.gameStart=function(){o(false);i=[];u();r.start(e.duration,e.onTimerDone,e.onTimerUpdate)}}